"use strict";function Widget(){function p(){document.getElementsByClassName("widget").item(0).classList.add("onDeletion"),function(e){if(localStorage.widget){var n=JSON.parse(localStorage.widget);n.push(e),10<n.length&&(n=n.slice(-10)),localStorage.widget=JSON.stringify(n)}else{var t=[e];localStorage.setItem("widget",JSON.stringify(t))}}("Gesloten")}return{showMessage:function(e,n,t){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){},i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[];if(0<document.getElementsByClassName("widget").length){var o=document.getElementsByClassName("widget").item(0);o.parentNode.removeChild(o)}var r=document.createElement("div"),c=document.createElement("span"),l=document.createElement("div"),s=document.createElement("div"),u=document.createElement("div");r.className+="widget","green"===t?(r.id="okWidget",c.innerHTML="<i class='fas fa-check'></i>"):(r.id="errorWidget",c.innerHTML="<i class='fas fa-exclamation'></i>"),c.id="widgetImage",r.appendChild(c);var d=document.createElement("h1");d.innerText=e,l.appendChild(d),s.id="crossButton",s.innerHTML="<i class='fas fa-times-circle'></i>",s.onclick=function(){p(),a()},function(e){new Promise(function(e){setTimeout(function(){e()},2e3)}).then(function(){!function(e){e.classList.add("shakingButton")}(e)})}(s),r.appendChild(s),l.innerHTML+="<br>",l.innerHTML+=n,l.id="container",r.appendChild(l),u.id="containerForButtons",(i=i||[]).reverse(),i.forEach(function(e){var n=document.createElement("button");n.innerText=e.name,n.onclick=function(){e.function(),p()},u.appendChild(n)}),r.appendChild(u),document.body.appendChild(r)},hideMessage:p}}var spa=function(o){var i;function n(e){var n=document.createElement("tr");n.className="gameRow";var t=document.createElement("td");t.innerText=e.blackPlayer.avatar,n.appendChild(t);var a=document.createElement("td");a.innerText=e.description,n.appendChild(a);var i=document.createElement("button");i.innerText="Meedoen",i.onclick=function(){!function(e){spa.data.joinGame(e).then(function(e){return console.log(e)}).catch(function(e){return console.log(e)}),console.log("We gaan meedoen aan een spel")}(e.id)},n.appendChild(i),o("#gameTable").append(n)}function r(){i.showMessage("Spel kiezen of maken","Kies een al uitstaand spel of maak er zelf één","green",function(){r()},[{name:"Spel kiezen",function:function(){spa.data.getSpellen().then(function(e){e.succeeded&&(null==e.result||0===e.result.length?i.showMessage("Geen spellen beschikbaar","Er zijn nog geen spellen gemaakt waar jij niet al in zit","red",function(){r()},[{name:"Spel maken",function:function(){a()}}]):(function(){var e=document.createElement("div");e.id="gameTableContainer",o("body").append(e),o("#gameTableContainer").append("<h2>Doe mee aan een spel van een ander</h2>");var n=document.createElement("table");n.id="gameTable",o("#gameTableContainer").append(n);var t=document.createElement("tr");t.id="tableHead",o("#gameTable").append(t),o("#tableHead").append("<th>Avatar tegenstander</th>"),o("#tableHead").append("<th>Beschrijving spel</th>")}(),e.result.forEach(function(e){n(e)})))}).catch(function(e){i.showMessage("Fout bij het ophalen van spellen",e.result)})}},{name:"Spel maken",function:function(){a()}}])}function t(){i.showMessage("Log in of registreer","Klik op de knop om in te loggen of je te registreren","green",function(){t()},[{name:"Inloggen of registreren",function:function(){window.location=spa.data.configMap.endpoints.loginregister}}])}function a(){var e=document.createElement("div");e.id="createGameForm",o("body").append(e),o("#createGameForm").append("<h2>Maak een nieuw spel</h2>");var n=document.createElement("input");n.id="Game_Description",n.name="Game.Description",o("#createGameForm").append(n);var t=document.createElement("button");t.id="createGameButton",t.innerText="Verzenden",t.onclick=function(){spa.data.createGame(o("#Game_Description").val()).then(function(){i.showMessage("Gelukt!","Je spel is nu opgeslagen!","green",function(){r()})}).catch(function(){i.showMessage("Mislukt...","Er ging iets mis bij het opslaan van het spel...","red",function(){r()})}).finally(function(){o("#createGameForm").remove()})},o("#createGameForm").append(t);var a=document.createElement("button");a.id="backButton",a.innerText="Terug",a.onclick=function(){r(),o("#createGameForm").remove()},o("#createGameForm").append(a)}return{init:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"development";return i=new Widget,spa.data.init(e),spa.model.init(),o("body").append("<h1>Welkom bij Reversi!</h1>"),spa.data.userIsLoggedIn().then(function(e){if(e){spa.data.getUser().then(function(e){spa.model.user=new spa.model.User(e.avatar)});var n=document.createElement("span");n.innerHTML="<a href='javascript:void(0)'>Uitloggen</a>",n.onclick=function(){spa.data.logout().then(function(){t()})},o("body").append(n),r()}else t()}),!0}}}(jQuery);spa.data=function(i){var o;return{init:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"development";return o={environment:e,endpoints:{}},"production"===e&&(o.endpoints.game="https://localhost:5001/api/game",o.endpoints.player="https://localhost:5001/api/player",o.endpoints.loginregister="https://localhost:5001/loginregister"),!0},configMap:function(){return o},getSpellen:function(){return new Promise(function(n,a){null!=o.endpoints.game?i.ajax({type:"GET",dataType:"json",url:o.endpoints.game+"/games",success:function(e){e=function(e){return e.filter(function(e){return e.blackPlayer.avatar!==spa.model.user.avatar&&null===e.blackPlayer.currentlyPlayingGame})}(e),n({succeeded:!0,result:e})},error:function(e,n,t){a({succeeded:!1,result:n+": "+t})}}):n()})},logout:function(){return new Promise(function(n,e){null!=o.endpoints.player?i.post(o.endpoints.player+"/logout",function(e){console.log(e),n("logged out")}).fail(function(){e("not logged out")}):n("logged out")})},userIsLoggedIn:function(){return new Promise(function(n,e){null!=o.endpoints.player?i.get(o.endpoints.player+"/isLoggedIn",function(e){n(e)}).fail(function(){e()}):n(!0)})},createGame:function(e){return new Promise(function(n,t){null!=o.endpoints.player?i.ajax({type:"POST",url:o.endpoints.game+"/create",contentType:"application/json",data:JSON.stringify(e),success:function(e){n(e)},error:function(e){t(e)}}):n()})},getUser:function(){return new Promise(function(n,e){null!=o.endpoints.player?i.get(o.endpoints.player+"/getLoggedInPlayer",function(e){n(e)}).fail(function(){e()}):n()})},joinGame:function(e){return new Promise(function(n,t){null!=o.endpoints.player?i.ajax({type:"POST",url:o.endpoints.game+"/join",contentType:"application/json",data:JSON.stringify(e),success:function(e){n(e)},error:function(e){t(e)}}):n()})}}}(jQuery),spa.model=(jQuery,{init:function(){return new Widget,!0},user:function(){},User:function(e){this.avatar=e}}),spa.reversi=(jQuery,{init:function(){return new Widget,!0}});var templateModule=(jQuery,{init:function(){return!0}});